# HashiCorp Vault Helm Chart Values
# Secrets management and encryption

vault:
  enabled: true

  # Image
  image:
    repository: hashicorp/vault
    tag: 1.17.0
    pullPolicy: IfNotPresent

  # Replicas
  replicas: 1

  # Server configuration
  server:
    enabled: true

    # Data storage
    dataStorage:
      enabled: true
      size: 5Gi
      storageClass: standard

    # Audit logging
    auditStorage:
      enabled: true
      size: 1Gi
      storageClass: standard

    # Resource limits
    resources:
      requests:
        cpu: 100m
        memory: 256Mi
      limits:
        cpu: 500m
        memory: 1Gi

    # Pod security context
    podSecurityContext:
      runAsNonRoot: true
      runAsUser: 100

    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
        - ALL
      readOnlyRootFilesystem: true

    # Service
    service:
      type: ClusterIP
      port: 8200

    # HA configuration
    ha:
      enabled: false
      replicas: 1

    # TLS Configuration
    # ENABLED: Cert-Manager generates TLS certificates automatically
    # Certificate is renewed 30 days before expiration by Cert-Manager
    # See manifests/vault/certificate.yaml for cert configuration
    tlsDisable: false

    # Reference Cert-Manager generated certificate
    # Certificate CRD creates this secret automatically
    existingSecret: vault-tls

    # Certificate and key are stored in the secret created by Cert-Manager
    # No need to manually provide cert/key PEM data

  # UI
  ui:
    enabled: true
    serviceType: ClusterIP

  # Auth methods
  authMethods:
    kubernetes:
      enabled: true
      path: kubernetes
    jwt:
      enabled: false

  # Secrets engines
  secretsEngines:
    kv:
      enabled: true
      version: 2
      path: secret
    pki:
      enabled: false
    ssh:
      enabled: false

  # Policies
  policies:
    default:
      enabled: true

# Service Monitor for Prometheus
serviceMonitor:
  enabled: true
  namespace: monitoring
  interval: 30s

# RBAC
rbac:
  create: true

# High availability
ha:
  enabled: false

# Ingress configuration for Kong
ingress:
  enabled: true
  ingressClassName: kong
  annotations:
    konghq.com/strip-path: "true"
  hosts:
    - host: vault.demo.local
      paths:
        - path: /
          pathType: Prefix
  tls: []

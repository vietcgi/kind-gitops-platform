# Global Configuration
# Single source of truth for all platform-wide settings

# Repository Configuration
repository:
  url: "https://github.com/vietcgi/kubernetes-platform-stack"
  branch: "main"

# Version Management
versions:
  kubernetes: "1.33.0"
  cilium: "1.17.0"
  istio: "1.28.0"
  prometheus: "2.48.0"
  grafana: "11.0.0"
  loki: "3.0.0"
  tempo: "2.3.0"
  argocd: "3.2.0"
  cert-manager: "1.14.0"
  vault: "1.17.0"
  falco: "0.37.0"
  kyverno: "1.12.0"
  sealed-secrets: "0.25.0"
  gatekeeper: "3.17.0"

# Namespace Configuration
namespaces:
  kube-system: "kube-system"
  istio-system: "istio-system"
  monitoring: "monitoring"
  argocd: "argocd"
  app: "app"
  cert-manager: "cert-manager"
  vault: "vault"
  falco: "falco"
  kyverno: "kyverno"
  sealed-secrets: "sealed-secrets"
  gatekeeper-system: "gatekeeper-system"
  audit-logging: "audit-logging"

# Image Configuration Defaults
image:
  pullPolicy: "IfNotPresent"
  registries:
    kubernetes: "ghcr.io"
    hashicorp: "registry.terraform.io"
    falco: "docker.io"
    opa: "openpolicyagent"

# Resource Profiles (t-shirt sizing)
resources:
  profiles:
    # Small: Sidecars, controllers, lightweight services
    small:
      requests:
        cpu: "50m"
        memory: "64Mi"
      limits:
        cpu: "200m"
        memory: "256Mi"

    # Medium: Standard services, workloads
    medium:
      requests:
        cpu: "100m"
        memory: "256Mi"
      limits:
        cpu: "500m"
        memory: "1Gi"

    # Large: Resource-intensive services (monitoring, mesh)
    large:
      requests:
        cpu: "200m"
        memory: "512Mi"
      limits:
        cpu: "1000m"
        memory: "2Gi"

    # DaemonSet: Node-local agents (Falco, CNI)
    daemonset:
      requests:
        cpu: "100m"
        memory: "512Mi"
      limits:
        cpu: "1000m"
        memory: "1024Mi"

# Security Contexts
security:
  # Standard non-privileged security context
  standard:
    runAsNonRoot: true
    runAsUser: 1000
    fsGroup: 1000
    securityContext:
      allowPrivilegeEscalation: false
      capabilities:
        drop:
          - ALL
      readOnlyRootFilesystem: true

  # System agent security context (Falco, DaemonSets)
  system_agent:
    runAsNonRoot: false
    runAsUser: 0
    securityContext:
      allowPrivilegeEscalation: true
      capabilities:
        add:
          - SYS_RESOURCE
          - SYS_ADMIN

# Service Account Configuration
serviceAccount:
  create: true
  automountServiceAccountToken: true

# RBAC Configuration
rbac:
  create: true

# Pod Disruption Budget
pdb:
  enabled: false
  minAvailable: 0

# Monitoring Configuration
monitoring:
  enabled: true
  namespace: "monitoring"
  interval: "30s"
  scrape_timeout: "30s"

# Helm Repository Configuration
helm:
  repositories:
    cilium: "https://helm.cilium.io"
    istio: "https://istio-release.storage.googleapis.com/charts"
    jetstack: "https://charts.jetstack.io"
    prometheus-community: "https://prometheus-community.github.io/helm-charts"
    grafana: "https://grafana.github.io/helm-charts"
    argoproj: "https://argoproj.github.io/argo-helm"
    hashicorp: "https://helm.releases.hashicorp.com"
    falcosecurity: "https://falcosecurity.github.io/charts"
    open-policy-agent: "https://open-policy-agent.github.io/gatekeeper/charts"
    bitnami: "https://charts.bitnami.com/bitnami"

# ArgoCD Configuration
argocd:
  namespace: "argocd"
  project: "default"
  sync_interval: "30s"
  # Standard sync policies
  policies:
    aggressive:
      # Full automated sync with pruning
      automated:
        prune: true
        selfHeal: true
      syncOptions:
        - CreateNamespace=true
        - RespectIgnoreDifferences=true
      revisionHistoryLimit: 10

    conservative:
      # Manual sync, self-healing enabled
      automated:
        prune: false
        selfHeal: true
      syncOptions:
        - CreateNamespace=true
      revisionHistoryLimit: 10

    none:
      # Manual sync only
      syncOptions:
        - CreateNamespace=true
      revisionHistoryLimit: 10

  # Retry configuration
  retry:
    limit: 5
    backoff:
      duration: "5s"
      factor: 2
      maxDuration: "3m"

  # CRD handling
  crd_handling:
    - group: "apiextensions.k8s.io"
      kind: "CustomResourceDefinition"
      jsonPointers:
        - "/spec/conversion"

  # Finalizer
  finalizer: "resources-finalizer.argocd.argoproj.io"

# Application Groups
application_groups:
  infrastructure:
    - cilium
    - argocd
  observability:
    - prometheus
    - loki
    - tempo
  service_mesh:
    - istio
  security:
    - cert-manager
    - vault
    - falco
    - kyverno
    - sealed-secrets
  governance:
    - gatekeeper
    - audit-logging
  applications:
    - my-app

# Feature Flags
features:
  bgp:
    enabled: true
    asn: 64512
  kube_proxy_replacement:
    enabled: true
  istio_injection:
    enabled: true
  network_policies:
    enabled: true
  audit_logging:
    enabled: true
  pod_security_policies:
    enabled: true
